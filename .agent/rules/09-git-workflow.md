# 09: Git/GitHub ワークフロー

> **アクティベーション**: 常にON
> このルールはすべての開発作業に適用される。

## リポジトリ情報

- **リモート**: `git@github.com:fumiya-antigravity/pmd-agent.git`
- **デフォルトブランチ**: `main`

## ブランチ戦略

| ブランチ | 目的 | 例 |
|---|---|---|
| `main` | 本番 | 常に動作する状態を維持 |
| `feature/*` | 新機能開発 | `feature/prompt-externalize` |
| `fix/*` | バグ修正 | `fix/related-updates-broken` |
| `refactor/*` | リファクタリング | `refactor/directory-structure` |

### ブランチルール
- `main`には直接プッシュしない（ただし初期セットアップ・ホットフィックスを除く）
- 作業は必ずブランチを切って行う
- 動作確認後に`main`へマージする
- マージ後にブランチを削除する

## コミット規約（Conventional Commits）

```
<type>: <日本語で簡潔な説明>

<任意: 詳細な説明>
```

### タイプ一覧

| タイプ | 用途 | 例 |
|---|---|---|
| `feat` | 新機能追加 | `feat: 関連観点の自動更新機能を追加` |
| `fix` | バグ修正 | `fix: 会話履歴に分析結果が保存されない問題を修正` |
| `refactor` | コード構造変更（動作変更なし） | `refactor: ai_api.jsをagents/に分割` |
| `docs` | ドキュメントのみの変更 | `docs: ai_rules.mdを更新` |
| `style` | フォーマット・スタイルの変更 | `style: インデント統一` |

### コミットメッセージのルール
- 1行目は50文字以内を目標
- 本文は「なぜこの変更が必要か」を記述
- 関連するファイル・機能を本文に列挙

## 段階的コミットの義務

- **1コミット = 1つの論理的変更**
  - ✗ NG: プロンプト修正 + UI変更 + バグ修正を1コミットにまとめる
  - ✓ OK: プロンプト修正、UI変更、バグ修正を個別にコミット
- **動作確認後にコミット**
  - 壊れた状態をコミットしない
  - ブラウザテスト → コミット の順序を守る
- **キャッシュバスティング更新はコミットに含める**
  - `index_v2.html`のバージョン更新は、該当する変更と同じコミットに含める

## .gitignore

以下は必ず除外する:
```
.env
__pycache__/
*.pyc
node_modules/
```

## エージェント（AI）への指示

AIエージェント（Antigravity等）が開発を行う際:
1. 機能実装後は必ず`git add -A && git commit`を実行する
2. コミットメッセージはConventional Commitsに従う
3. 大きな変更はブランチを切ってから作業する
4. `git status`で未コミットの変更がないか定期確認する
