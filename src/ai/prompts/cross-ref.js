/* ===================================================
   プロンプト: 横展開Crew
   責務: ユーザー発言が他の4観点に与える影響の分析・更新
   対応する現行責務: #6(relatedUpdates + 補完ステップ)
   =================================================== */

const CrossRefPrompt = (() => {
    'use strict';

    const PROMPT = `## タスク: 知見の横展開・横断分析
ユーザーの発言がフォーカス中の観点以外にどう関連するかを分析し、関連する観点を更新せよ。

## スキルセット
- **暗黙知の発掘**: 直接言及されていない情報を文脈から推測し、関連観点に補完する
- **因果関係の推論**: 「背景→課題→ターゲット→効果→緊急性」のチェーンを意識する
- **矛盾検出**: 横展開時に既存textとの矛盾をチェックする
- **柔軟な発想**: 一見無関係に見えるが実は示唆がある、という発見を重視する

## 横展開の義務
ユーザーの発言を処理する際、以下を必ず実行せよ:
1. 全ての他観点のtextを確認する
2. ユーザーの今回の発言が他の観点の解像度を上げるか判定する
3. 上がる場合は**必ず**relatedUpdatesで更新を返す

## 横展開の具体例
- ユーザーが背景で「ドメイン知識がないと理解できない要件定義書が問題」と述べた
  → problem: 「要件定義書がドメイン知識前提で書かれており、新メンバーが理解できない」に更新
  → target: 「ドメイン知識を持たないPdMや新規参画メンバー」に更新
  → impact: 「ドメイン知識不要で誰でも理解できる要件定義書が作れるようになる」に更新
- ユーザーが課題で「Howで語られるドキュメントが多い」と述べた
  → background: 「既存のドキュメント文化がHow中心で、Whyの言語化が習慣化されていない」に追記

## 判定基準
各観点について0.0〜1.0のrelevanceScoreで関連度を判定:
- 0.0-0.3: 更新しない（含めなくてよい）
- 0.4-0.6: 記録のみ（action: 'skip'で記録）
- 0.7-1.0: **必ず更新する**（action: 'append' or 'overwrite'）

## 必須チェックリスト（毎回実行）
1. background: 背景に追記できる情報はないか？
2. problem: 課題の具体化に使える情報はないか？
3. target: ターゲットを推測できないか？
4. impact: 期待効果の具体化に使える情報はないか？
5. urgency: 今やる理由を推測できないか？
※ フォーカス中の観点は除く

## ルール
- relatedUpdatesを空配列にしないこと。必ず1つ以上の観点を含めよ。
- 本当に関連がない場合のみ、action='skip'で全観点を列挙（理由を明記）。
- newTextは更新後の全文を記述する（既存textの内容を含めた上で新情報を追加）。
- 既存textと矛盾する場合は更新せず、contradictionCheckで矛盾を記録する。

## JSON形式
{
  "thinking": "横展開分析: 各観点への影響度の推論（3行以上）",
  "relatedUpdates": [
    {"aspect": "観点キー", "relevanceScore": 0.8, "action": "append|overwrite|skip", "reason": "更新理由", "newText": "更新後の全文（3行以上）", "newStatus": "ok|thin", "contradictionCheck": "既存textとの矛盾有無"}
  ]
}`;

    function get() { return PROMPT; }

    return { get };
})();
